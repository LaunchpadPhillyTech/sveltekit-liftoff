import{c as x,l as A,a as Q}from"../chunks/BrMm2hgS.js";import{i as M}from"../chunks/BbwcdWCu.js";import{f as N,o as T,a as e,m as D,aj as R,M as k,N as V,Q as z,d as u,R as G,x as C,aK as H,F as b,q as U,v as X,w as Z,D as ee,k as te}from"../chunks/Dw_2Oecw.js";import{p as g,s as ne}from"../chunks/CYqAogjs.js";import{a as j,s as q}from"../chunks/C3FaNfmW.js";import{l as ae}from"../chunks/_nvnlwVx.js";$[b]="src/components/Analytics.svelte";function $(E,m){x(new.target),N(m,!1,$);const[h,v]=q(),c=()=>(H(g,"page"),j(g,"$page",h));let t=D(Date.now()),l=0,n=D(0),s=D(0);T(()=>{a("page_load",{path:c().url.pathname,referrer:document.referrer,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}});let o=!1;function w(){const i=window.pageYOffset,r=document.documentElement.scrollHeight-window.innerHeight;l=Math.round(i/r*100),l>e(n)&&u(n,l),o=!1}function d(){o||(requestAnimationFrame(w),o=!0)}function S(i){var P;R(s);const r=i.target,y=r.tagName.toLowerCase(),Y=r.className,B=r.id,K=(P=r.textContent)==null?void 0:P.slice(0,50);(k(y,"button")||k(y,"a")||r.closest("button, a"))&&a("interaction",{type:"click",element:y,className:Y,id:B,text:K,scrollDepth:e(n),timeOnPage:Date.now()-e(t)})}const _=[10,30,60,120,300];let p=0;const J=setInterval(()=>{const i=Math.floor((Date.now()-e(t))/1e3);p<_.length&&i>=_[p]&&(a("time_milestone",{milestone:_[p],scrollDepth:e(n),interactions:e(s)}),p++)},1e3);function I(){document.hidden?a("tab_hidden",{timeOnPage:Date.now()-e(t),scrollDepth:e(n)}):a("tab_visible",{timeOnPage:Date.now()-e(t)})}function L(i){i.clientY<=0&&window.innerWidth>768&&a("exit_intent",{timeOnPage:Date.now()-e(t),scrollDepth:e(n),interactions:e(s)})}function O(){window.innerWidth<=768&&a("mobile_exit_intent",{timeOnPage:Date.now()-e(t),scrollDepth:e(n)})}return window.addEventListener("scroll",d,{passive:!0}),document.addEventListener("click",S,!0),document.addEventListener("visibilitychange",I),document.addEventListener("mouseleave",L),window.addEventListener("blur",O),()=>{clearInterval(J),window.removeEventListener("scroll",d),document.removeEventListener("click",S),document.removeEventListener("visibilitychange",I),document.removeEventListener("mouseleave",L),window.removeEventListener("blur",O),a("session_end",{totalTime:Date.now()-e(t),maxScrollDepth:e(n),totalInteractions:e(s)})}});async function a(o,w={}){try{(await V(fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:o,data:{...w,timestamp:new Date().toISOString(),url:window.location.href,sessionId:F()}})})))()}catch(d){console.error(...ae("error","Analytics tracking failed:",d))}}function F(){let o=sessionStorage.getItem("analytics_session_id");return o||(o="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("analytics_session_id",o)),o}window.trackEvent=a,z(()=>(c(),e(t)),()=>{c().url.pathname&&(a("route_change",{from:document.referrer,to:c().url.pathname,timeOnPreviousPage:Date.now()-e(t)}),u(t,Date.now()),u(n,0),u(s,0))}),G(),M();var W=C({...A()});return v(),W}f[b]="src/routes/+layout.svelte";var oe=Q(ee("<!> <!>",1),f[b],[]);function f(E,m){x(new.target),N(m,!1,f);const[h,v]=q(),c=()=>(H(g,"page"),j(g,"$page",h));T(()=>{fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"page_view",data:{path:c().url.pathname}})})}),M();var t=oe(),l=U(t);X(()=>$(l,{}),"component",f,20,0,{componentTag:"Analytics"});var n=te(l,2);ne(n,m,"default",{}),Z(E,t);var s=C({...A()});return v(),s}export{f as component};
