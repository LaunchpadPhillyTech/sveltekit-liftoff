import{c as x,l as A,a as X}from"../chunks/Cctr9Hhf.js";import{i as T}from"../chunks/BPQTiZJ7.js";import{X as M,ai as N,b as e,m as D,aj as z,ak as k,al as G,am as K,a as g,an as Q,$ as C,ao as H,a0 as $,Y as R,ap as U,_ as Z,a1 as ee,a4 as te}from"../chunks/DcJ2dBsV.js";import{l as ne,s as ae}from"../chunks/n3dvextg.js";import{s as j,a as W}from"../chunks/LvHc43wS.js";import{s as oe}from"../chunks/D9n3Me_s.js";const se=()=>{const s=oe;return{page:{subscribe:s.page.subscribe},navigating:{subscribe:s.navigating.subscribe},updated:s.updated}},f={subscribe(s){return se().page.subscribe(s)}};E[$]="src/components/Analytics.svelte";function E(s,m){x(new.target),M(m,!1,E);const[v,w]=W(),l=()=>(H(f,"page"),j(f,"$page",v));let t=D(Date.now()),d=0,n=D(0),i=D(0);N(()=>{a("page_load",{path:l().url.pathname,referrer:document.referrer,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}});let o=!1;function _(){const r=window.pageYOffset,c=document.documentElement.scrollHeight-window.innerHeight;d=Math.round(r/c*100),d>e(n)&&g(n,d),o=!1}function u(){o||(requestAnimationFrame(_),o=!0)}function S(r){var P;z(i);const c=r.target,y=c.tagName.toLowerCase(),J=c.className,B=c.id,V=(P=c.textContent)==null?void 0:P.slice(0,50);(k(y,"button")||k(y,"a")||c.closest("button, a"))&&a("interaction",{type:"click",element:y,className:J,id:B,text:V,scrollDepth:e(n),timeOnPage:Date.now()-e(t)})}const b=[10,30,60,120,300];let p=0;const F=setInterval(()=>{const r=Math.floor((Date.now()-e(t))/1e3);p<b.length&&r>=b[p]&&(a("time_milestone",{milestone:b[p],scrollDepth:e(n),interactions:e(i)}),p++)},1e3);function I(){document.hidden?a("tab_hidden",{timeOnPage:Date.now()-e(t),scrollDepth:e(n)}):a("tab_visible",{timeOnPage:Date.now()-e(t)})}function L(r){r.clientY<=0&&window.innerWidth>768&&a("exit_intent",{timeOnPage:Date.now()-e(t),scrollDepth:e(n),interactions:e(i)})}function O(){window.innerWidth<=768&&a("mobile_exit_intent",{timeOnPage:Date.now()-e(t),scrollDepth:e(n)})}return window.addEventListener("scroll",u,{passive:!0}),document.addEventListener("click",S,!0),document.addEventListener("visibilitychange",I),document.addEventListener("mouseleave",L),window.addEventListener("blur",O),()=>{clearInterval(F),window.removeEventListener("scroll",u),document.removeEventListener("click",S),document.removeEventListener("visibilitychange",I),document.removeEventListener("mouseleave",L),window.removeEventListener("blur",O),a("session_end",{totalTime:Date.now()-e(t),maxScrollDepth:e(n),totalInteractions:e(i)})}});async function a(o,_={}){try{(await G(fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:o,data:{..._,timestamp:new Date().toISOString(),url:window.location.href,sessionId:Y()}})})))()}catch(u){console.error(...ne("error","Analytics tracking failed:",u))}}function Y(){let o=sessionStorage.getItem("analytics_session_id");return o||(o="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),sessionStorage.setItem("analytics_session_id",o)),o}window.trackEvent=a,K(()=>(l(),e(t)),()=>{l().url.pathname&&(a("route_change",{from:document.referrer,to:l().url.pathname,timeOnPreviousPage:Date.now()-e(t)}),g(t,Date.now()),g(n,0),g(i,0))}),Q(),T();var q=C({...A()});return w(),q}h[$]="src/routes/+layout.svelte";var ie=X(ee("<!> <!>",1),h[$],[]);function h(s,m){x(new.target),M(m,!1,h);const[v,w]=W(),l=()=>(H(f,"page"),j(f,"$page",v));N(()=>{fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event:"page_view",data:{path:l().url.pathname}})})}),T();var t=ie(),d=R(t);U(()=>E(d,{}),"component",h,21,0,{componentTag:"Analytics"});var n=te(d,2);ae(n,m,"default",{}),Z(s,t);var i=C({...A()});return w(),i}export{h as component};
