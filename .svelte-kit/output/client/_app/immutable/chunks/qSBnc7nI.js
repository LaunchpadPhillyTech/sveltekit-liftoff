import{c as ce,l as ue,a as E}from"./BrMm2hgS.js";import{i as de}from"./BbwcdWCu.js";import{a7 as ve,t as me,aW as ge,aX as X,f as fe,o as he,aY as pe,Q as Se,R as we,aM as j,q as k,v as P,w as d,x as _e,N as J,d as F,S as ye,a as b,m as K,aK as Pe,F as p,D as q,M as Q,y as N,u as A,C as R,E as W,k as be,I as Ae}from"./Dw_2Oecw.js";import{p as D,i as T}from"./CbBVm8cr.js";import{s as De}from"./BoZ-ZWwg.js";import{s as Te,a as Ce}from"./C3FaNfmW.js";function Ee(a,s,r){var e=ve(a,s);e&&e.set&&(a[s]=r,me(()=>{a[s]=null}))}const qe="GY6AI_Assessment",Oe=1,l="assessment_progress";class xe{constructor(){this.db=null}async init(){return new Promise((s,r)=>{const e=indexedDB.open(qe,Oe);e.onerror=()=>r(e.error),e.onsuccess=()=>{this.db=e.result,s(this.db)},e.onupgradeneeded=t=>{const n=t.target.result;if(!n.objectStoreNames.contains(l)){const o=n.createObjectStore(l,{keyPath:"id"});o.createIndex("section","section",{unique:!1}),o.createIndex("timestamp","timestamp",{unique:!1})}}})}async saveProgress(s,r){this.db||await this.init();const e={id:`assessment_${s}`,section:s,data:r,timestamp:new Date().toISOString(),completionStatus:r.completionStatus||"in_progress"};return new Promise((t,n)=>{const h=this.db.transaction([l],"readwrite").objectStore(l).put(e);h.onerror=()=>n(h.error),h.onsuccess=()=>t(e)})}async getProgress(s){return this.db||await this.init(),new Promise((r,e)=>{const o=this.db.transaction([l],"readonly").objectStore(l).get(`assessment_${s}`);o.onerror=()=>e(o.error),o.onsuccess=()=>r(o.result||null)})}async getAllProgress(){return this.db||await this.init(),new Promise((s,r)=>{const n=this.db.transaction([l],"readonly").objectStore(l).getAll();n.onerror=()=>r(n.error),n.onsuccess=()=>s(n.result||[])})}async deleteProgress(s){return this.db||await this.init(),new Promise((r,e)=>{const o=this.db.transaction([l],"readwrite").objectStore(l).delete(`assessment_${s}`);o.onerror=()=>e(o.error),o.onsuccess=()=>r(!0)})}async clearAllProgress(){return this.db||await this.init(),new Promise((s,r)=>{const n=this.db.transaction([l],"readwrite").objectStore(l).clear();n.onerror=()=>r(n.error),n.onsuccess=()=>s(!0)})}async getAssessmentOverview(){const s=await this.getAllProgress(),r=["client-acquisition","technical-solution","prompt-engineering","implementation"],e={startTime:null,totalProgress:0,sections:{},isComplete:!1};s.forEach(n=>{(!e.startTime||new Date(n.timestamp)<new Date(e.startTime))&&(e.startTime=n.timestamp)}),r.forEach(n=>{const o=s.find(f=>f.section===n);e.sections[n]={completed:(o==null?void 0:o.completionStatus)==="completed"||!1,hasProgress:!!o,lastSaved:(o==null?void 0:o.timestamp)||null,data:(o==null?void 0:o.data)||null}});const t=Object.values(e.sections).filter(n=>n.completed).length;return e.totalProgress=t/r.length*100,e.isComplete=t===r.length,e}async saveTimeSpent(s,r){const e=await this.getProgress(s),t=(e==null?void 0:e.data)||{};return t.timeSpent=(t.timeSpent||0)+r,this.saveProgress(s,t)}async getTotalTimeSpent(){return(await this.getAllProgress()).reduce((r,e)=>{var t;return r+(((t=e.data)==null?void 0:t.timeSpent)||0)},0)}}const m=new xe,C=X({startTime:null,totalProgress:0,sections:{"client-acquisition":{completed:!1,hasProgress:!1,lastSaved:null},"technical-solution":{completed:!1,hasProgress:!1,lastSaved:null},"prompt-engineering":{completed:!1,hasProgress:!1,lastSaved:null},implementation:{completed:!1,hasProgress:!1,lastSaved:null}},isComplete:!1,timeRemaining:null}),g=X({isEnabled:!0,lastSaved:null,isSaving:!1,hasUnsavedChanges:!1});ge(C,a=>{if(!a.startTime)return null;const s=new Date(a.startTime),e=new Date-s,t=Math.max(0,48*60*60*1e3-e);return{elapsed:e,remaining:t,formattedRemaining:Ie(t),isExpired:t<=0,hoursRemaining:Math.floor(t/(60*60*1e3))}});function Ie(a){if(a<=0)return"Expired";const s=Math.floor(a/(60*60*1e3)),r=Math.floor(a%(60*60*1e3)/(60*1e3));return s>0?`${s}h ${r}m remaining`:`${r}m remaining`}const B={async loadProgress(){try{const a=await m.getAssessmentOverview();return C.set(a),a}catch(a){return console.error("Failed to load assessment progress:",a),null}},async saveProgress(a,s,r="in_progress"){try{return g.update(e=>({...e,isSaving:!0})),await m.saveProgress(a,{...s,completionStatus:r}),C.update(e=>({...e,sections:{...e.sections,[a]:{completed:r==="completed",hasProgress:!0,lastSaved:new Date().toISOString()}}})),await this.loadProgress(),g.update(e=>({...e,isSaving:!1,lastSaved:new Date().toISOString(),hasUnsavedChanges:!1})),!0}catch(e){return console.error("Failed to save assessment progress:",e),g.update(t=>({...t,isSaving:!1})),!1}},async startAssessment(){try{(await m.getAssessmentOverview()).startTime||await m.saveProgress("overview",{startTime:new Date().toISOString()}),await this.loadProgress()}catch(a){console.error("Failed to start assessment:",a)}},async completeSection(a,s){return this.saveProgress(a,s,"completed")},async getSectionData(a){try{const s=await m.getProgress(a);return(s==null?void 0:s.data)||null}catch(s){return console.error("Failed to get section data:",s),null}},async clearProgress(){try{return await m.clearAllProgress(),C.set({startTime:null,totalProgress:0,sections:{"client-acquisition":{completed:!1,hasProgress:!1,lastSaved:null},"technical-solution":{completed:!1,hasProgress:!1,lastSaved:null},"prompt-engineering":{completed:!1,hasProgress:!1,lastSaved:null},implementation:{completed:!1,hasProgress:!1,lastSaved:null}},isComplete:!1,timeRemaining:null}),!0}catch(a){return console.error("Failed to clear progress:",a),!1}},markUnsavedChanges(){g.update(a=>({...a,hasUnsavedChanges:!0}))}};c[p]="src/components/ui/AutoSave.svelte";function Me(a){const s=new Date,r=new Date(a),e=s-r;return e<6e4?"just now":e<36e5?`${Math.floor(e/6e4)}m ago`:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}var Ue=E(q('<div class="status-indicator svelte-ln59yi"><div class="spinner svelte-ln59yi"></div> <span class="svelte-ln59yi">Saving...</span></div>'),c[p],[[71,6,[[72,8],[73,8]]]]),je=E(q('<div class="status-indicator unsaved svelte-ln59yi"><div class="dot svelte-ln59yi"></div> <span class="svelte-ln59yi">Unsaved changes</span></div>'),c[p],[[76,6,[[77,8],[78,8]]]]),ke=E(q('<div class="status-indicator saved svelte-ln59yi"><div class="check svelte-ln59yi"></div> <span class="svelte-ln59yi"> </span></div>'),c[p],[[81,6,[[82,8],[83,8]]]]),Fe=E(q("<div><!></div>"),c[p],[[69,2]]);function c(a,s){ce(new.target),fe(s,!1,c);const[r,e]=Te(),t=()=>(Pe(g,"autoSaveStatus"),Ce(g,"$autoSaveStatus",r));let n=D(s,"sectionId",8,""),o=D(s,"data",24,()=>({})),f=D(s,"interval",8,3e4),h=D(s,"showStatus",8,!0),O,x=K(!1),S=K("");he(()=>{f()>0&&n()&&(O=setInterval(async()=>{b(x)&&!t().isSaving&&(await J(I()))()},f())),window.addEventListener("beforeunload",L)}),pe(()=>{O&&clearInterval(O),window.removeEventListener("beforeunload",L)});async function I(){if(!n()||t().isSaving)return;const i=(await J(B.saveProgress(n(),o())))();return i&&F(x,!1),i}function L(i){if(t().hasUnsavedChanges)return i.preventDefault(),i.returnValue="You have unsaved changes. Are you sure you want to leave?",i.returnValue}Se(()=>(ye(o()),b(S),B),()=>{const i=JSON.stringify(o());Q(i,b(S),!1)&&Q(b(S),"",!1)&&(F(x,!0),B.markUnsavedChanges()),F(S,i)}),we(),de();var V=j(),$=k(V);{var z=i=>{var w=Fe();let Y;var Z=N(w);{var ee=u=>{var _=Ue();d(u,_)},se=u=>{var _=j(),te=k(_);{var ae=v=>{var y=je();d(v,y)},re=v=>{var y=j(),ne=k(y);{var oe=M=>{var U=ke(),G=be(N(U),2),ie=N(G);R(G),R(U),W(le=>Ae(ie,`Saved ${le??""}`),[()=>(t(),A(()=>Me(t().lastSaved)))]),d(M,U)};P(()=>T(ne,M=>{t(),A(()=>t().lastSaved)&&M(oe)},!0),"if",c,80,4)}d(v,y)};P(()=>T(te,v=>{t(),A(()=>t().hasUnsavedChanges)?v(ae):v(re,!1)},!0),"if",c,75,4)}d(u,_)};P(()=>T(Z,u=>{t(),A(()=>t().isSaving)?u(ee):u(se,!1)}),"if",c,70,4)}R(w),W(u=>Y=De(w,1,"auto-save-status svelte-ln59yi",null,Y,u),[()=>({saving:t().isSaving,unsaved:t().hasUnsavedChanges})]),d(i,w)};P(()=>T($,i=>{h()&&i(z)}),"if",c,68,0)}d(a,V),Ee(s,"save",I);var H=_e({get save(){return I},...ue()});return e(),H}export{c as A,B as a,C as b};
